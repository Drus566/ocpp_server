<!DOCTYPE html>
<html>

<head>
	<title>WebSocket Debug</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			padding: 20px;
		}

		button {
			padding: 10px;
			margin: 5px;
			font-size: 16px;
		}

		.status {
			padding: 10px;
			margin: 10px 0;
			border-radius: 5px;
		}

		.connected {
			background: #d4edda;
			color: #155724;
		}

		.disconnected {
			background: #f8d7da;
			color: #721c24;
		}

		#messages {
			border: 1px solid #ccc;
			padding: 10px;
			height: 300px;
			overflow-y: scroll;
		}

		.message {
			margin: 5px 0;
			padding: 5px;
			border-bottom: 1px solid #eee;
		}

		.sent {
			background: #e3f2fd;
		}

		.received {
			background: #f3e5f5;
		}
	</style>
</head>

<body>
	<h1>WebSocket Debug Console</h1>

	<div class="status disconnected" id="status">
		Status: Disconnected
	</div>

	<div>
		<button onclick="connect()">Connect</button>
		<button onclick="disconnect()">Disconnect</button>
		<button onclick="sendPing()">Send Ping</button>
		<button onclick="startCharging()">Start Charging</button>
		<button onclick="stopCharging()">Stop Charging</button>
		<button onclick="clearMessages()">Clear</button>
	</div>

	<h3>Messages:</h3>
	<div id="messages"></div>

	<script>
        let ws = null;
        let messageId = 1;
        
        function addMessage(text, type) {
            const messages = document.getElementById('messages');
            const message = document.createElement('div');
            message.className = 'message ' + type;
            message.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${text}`;
            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        }
        
        function updateStatus(connected) {
            const status = document.getElementById('status');
            if (connected) {
                status.className = 'status connected';
                status.textContent = 'Status: Connected';
            } else {
                status.className = 'status disconnected';
                status.textContent = 'Status: Disconnected';
            }
        }
        
        function connect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                addMessage('Already connected', 'info');
                return;
            }
            
            addMessage('Connecting to ws://localhost:8080...', 'info');
            ws = new WebSocket('ws://localhost:8080');
            
            ws.onopen = function(event) {
                addMessage('‚úÖ WebSocket connection established!', 'received');
                updateStatus(true);
                console.log('WebSocket connected:', event);
            };
            
            ws.onmessage = function(event) {
                addMessage('üì® Received: ' + event.data, 'received');
                console.log('WebSocket message received:', event.data);
            };
            
            ws.onerror = function(error) {
                addMessage('‚ùå WebSocket error: ' + error, 'error');
                console.error('WebSocket error:', error);
            };
            
            ws.onclose = function(event) {
                addMessage('üîå WebSocket connection closed', 'info');
                updateStatus(false);
                console.log('WebSocket closed:', event);
            };
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }
        
        function sendPing() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('Not connected!', 'error');
                return;
            }
            
            const message = {
                jsonrpc: "2.0",
                id: messageId++,
                method: "ping",
                params: { timestamp: Date.now() }
            };
            
            const jsonMessage = JSON.stringify(message);
            ws.send(jsonMessage);
            addMessage('üì§ Sent: ' + jsonMessage, 'sent');
            console.log('Sent message:', jsonMessage);
        }
        
        function startCharging() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('Not connected!', 'error');
                return;
            }
            
            const message = {
                jsonrpc: "2.0",
                id: messageId++,
                method: "startCharging",
                params: {}
            };
            
            const jsonMessage = JSON.stringify(message);
            ws.send(jsonMessage);
            addMessage('üì§ Sent: ' + jsonMessage, 'sent');
            console.log('Sent startCharging:', jsonMessage);
        }
        
        function stopCharging() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('Not connected!', 'error');
                return;
            }
            
            const message = {
                jsonrpc: "2.0",
                id: messageId++,
                method: "stopCharging",
                params: {}
            };
            
            const jsonMessage = JSON.stringify(message);
            ws.send(jsonMessage);
            addMessage('üì§ Sent: ' + jsonMessage, 'sent');
            console.log('Sent stopCharging:', jsonMessage);
        }
        
        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
        }
        
        // Auto-connect on load
        window.onload = connect;
	</script>
</body>

</html>